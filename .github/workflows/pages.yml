name: Deploy Next.js to Github Pages
on:
 push:
  branches:
  - github-pages
 workflow_dispatch:
permissions:
 contents: read
 pages: write
 id-token: write
jobs:
 build:
  runs-on: ubuntu-latest
  steps:
  - name: checkout
    uses: actions/checkout@v4
  - name: setup node
    uses: actions/setup-node@v4
    with:
     node-version: "20"
  - name: restore cache
    uses: actions/cache@v4
    with:
     path: .next/cache
     key: ${{ runner.os }}-nextjs-${{ hashFiles('**/package-lock.json') }}-${{ hashFiles('**.[jt]s','**.[jt]sx','**.css','**.json') }}
     restore-keys: ${{ runner.os }}-nextjs-${{ hashFiles('**/package-lock.json') }}-
  - name: install dependencies
    run: npm i
  - name: build
    run: npm run build
  - name: upload artifact
    uses: actions/upload-pages-artifact@v3
    with:
     path: ./out
 deploy:
  environment:
   name: github-pages
   url: ${{ steps.deployment.outputs.page_url }}
  runs-on: ubuntu-latest
  needs: build
  steps:
  - name: deploy
    id: deployment
    uses: actions/deploy-pages@v4
